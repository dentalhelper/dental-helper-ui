<div class="content">
  <app-default-header titulo="Usuários" buttonId="add-usuario" buttonText="Adicionar Usuário"
    (botaoClicado)="criarUsuario()">
  </app-default-header>

  <div class="ui-g">
    <div class="ui-g-12">
      <p-table [value]="usuarios" #tabela responsive="true" [paginator]="true" [rows]="20">
        <ng-template pTemplate="header">
          <tr>
            <th>Status</th>
            <th>Nome</th>
            <th>Login</th>
            <th>Cargo</th>
            <th>Telefone</th>
            <th></th>
          </tr>
        </ng-template>

        <ng-template pTemplate="body" let-usuario>
          <tr>
            <td class="cell--center">
              <span class="ui-column-title">Status</span>
              <span class="cell__badge cell__badge--success"
                [ngClass]="{'cell__badge--success': usuario.ativo, 'cell__badge--danger': !usuario.ativo}">
                {{ usuario.ativo | statusUsuario }}
              </span>
            </td>
            <td>
              <span class="ui-column-title">Nome</span>
              {{ usuario.nome }}
            </td>
            <td>
              <span class="ui-column-title">Login</span>
              {{ usuario.login }}
            </td>
            <td>
              <span class="ui-column-title">Cargo</span>
              {{ usuario.tipo }}
            </td>
            <td>
              <span class="ui-column-title">Telefone</span>
              {{ usuario.telefonePrincipal | telefone }}
            </td>
            <td>
              <div class="operacoes">
                <button type="button" class="operacoes__button operacoes__button--edit" pTooltip="Editar"
                  tooltipPosition="top" [routerLink]="['/usuarios', usuario.codigo, 'edit']">
                  <fa-icon [icon]="['fas', 'edit']" size="lg" [fixedWidth]="true"></fa-icon>
                </button>

                <button type="button" class="operacoes__button operacoes__button--password" pTooltip="Alterar Senha"
                  tooltipPosition="top" (click)="abrirModalSenha(usuario)">
                  <fa-icon [icon]="['fas', 'unlock-alt']" size="lg" [fixedWidth]="true"></fa-icon>
                </button>

                <button type="button" class="operacoes__button operacoes__button--delete"
                  (click)="alterarStatus(usuario.codigo)" [pTooltip]="usuario.ativo ? 'Desativar' : 'Ativar'"
                  tooltipPosition="top">
                  <fa-icon [icon]="['fas', usuario.ativo ? 'user-check' : 'user-times']" size="lg" [fixedWidth]="true">
                  </fa-icon>
                </button>
              </div>
            </td>
          </tr>
        </ng-template>

        <ng-template pTemplate="emptymessage">
          <tr>
            <td colspan="6">
              Nenhum Usuário encontrado!<br />
              Clique <a [routerLink]="['/usuarios/novo']">AQUI</a> para cadastrar.
            </td>
          </tr>
        </ng-template>

      </p-table>
    </div>
  </div>
</div>


<p-dialog [(visible)]="exibirModal" modal="true" #modal (onHide)="resetarFormulario()" [style]="{width: '400px'}">
  <p-header>
    <span [title]="usuarioModal?.nome">
      Alterar senha de {{ usuarioModal?.nome | shorten:25 }}
    </span>
  </p-header>
  <div class="modal">
    <form novalidate [formGroup]="formulario" class="i-container">

      <app-input-container label="Senha atual" for="senha-atual" errorMessage="Senha atual é obrigatória.">
        <input class="i-container__input" type="password" id="senha-atual" formControlName="senhaAtual"
          autocomplete="none">
      </app-input-container>

      <app-input-container label="Nova senha" for="nova-senha" errorMessage="Nova senha é obrigatório.">
        <input class="i-container__input" type="password" id="nova-senha" formControlName="novaSenha"
          autocomplete="new-password">
      </app-input-container>

      <app-input-container label="Confirmação da nova senha" for="confirm-senha"
        errorMessage="Confirmação da senha é obrigatório.">
        <input class="i-container__input" type="password" id="confirm-senha" formControlName="confirmacaoDeSenhaAtual"
          autocomplete="new-password">
      </app-input-container>

    </form>

  </div>
  <p-footer>
    <app-button label="Salvar" icon="fas fa-hdd" iconPosition="right" (botaoClicado)="[alterarSenha()]"
      [classes]="['botao--success']">
    </app-button>

    <app-button label="Cancelar" icon="fas fa-times" iconPosition="right" (botaoClicado)="[fecharModal()]"
      [classes]="['ui-button-secondary']">
    </app-button>
  </p-footer>
</p-dialog>
